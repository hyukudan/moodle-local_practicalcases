/**
 * Timer module for timed practice mode.
 *
 * @module     local_casospracticos/timer
 * @copyright  2026 Sergio C.
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
/**
 * Timer module for timed practice mode.
 *
 * @module     local_casospracticos/timer
 * @copyright  2026 Sergio C.
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_casospracticos/timer",["jquery"],function(t){var e={timeLeft:0,autoSubmit:!1,interval:null,init:function(t,i){this.timeLeft=t,this.autoSubmit=i||!1,this.updateDisplay(),this.startCountdown(),window.addEventListener("beforeunload",function(t){if(e.timeLeft>0){var i="Your timed attempt is still in progress. Are you sure you want to leave?";return t.returnValue=i,i}})},startCountdown:function(){this.interval=setInterval(function(){e.timeLeft--,e.updateDisplay(),300===e.timeLeft&&e.showWarning("5 minutes remaining!"),60===e.timeLeft&&e.showWarning("1 minute remaining!"),e.timeLeft<=0&&(clearInterval(e.interval),e.timeExpired())},1e3)},updateDisplay:function(){var e=t("#timer-display");if(e.length){var i=Math.floor(this.timeLeft/3600),n=Math.floor(this.timeLeft%3600/60),r=this.timeLeft%60,a="";i>0&&(a+=i+":"),a+=(n<10?"0":"")+n+":",a+=(r<10?"0":"")+r,e.text(a);var s=e.closest(".alert");this.timeLeft<=60?s.removeClass("alert-info alert-warning").addClass("alert-danger"):this.timeLeft<=300&&s.removeClass("alert-info alert-danger").addClass("alert-warning"),this.timeLeft<=30?e.addClass("timer-pulse"):e.removeClass("timer-pulse")}},showWarning:function(t){require(["core/notification"],function(e){e.addNotification({message:t,type:"warning"})})},timeExpired:function(){if(t("#timer-display").text("TIME UP!").addClass("timer-expired"),this.autoSubmit){var e=t("#timed-practice-form");e.length&&(require(["core/notification"],function(t){t.addNotification({message:"Time is up! Submitting your answers...",type:"error"})}),setTimeout(function(){e.submit()},2e3))}else t("input, button, select, textarea").prop("disabled",!0),require(["core/notification"],function(t){t.addNotification({message:"Time is up! Please submit your answers.",type:"error"})})}};return e});
