/**
 * Case editor module for practical cases.
 *
 * @module     local_casospracticos/case_editor
 * @copyright  2026 Sergio C.
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],function(e,t,n,i,o,s){var a=function(t){this.caseId=t,this.container=e('.local-casospracticos-case-view[data-caseid="'+t+'"]'),this.init()};return a.prototype.init=function(){this.bindEvents()},a.prototype.bindEvents=function(){var t=this;this.container.find(".case-questions").sortable({items:".question-item",handle:".card-header",cursor:"move",placeholder:"question-placeholder card mb-3",update:function(e,n){t.handleQuestionReorder(n.item)}}),this.container.on("dblclick",".question-text",function(n){e(this).find("textarea").length||t.enableInlineEdit(e(this))}),this.container.on("click",'.question-actions a[href*="deletequestion"]',function(n){n.preventDefault(),t.confirmDeleteQuestion(e(this))})},a.prototype.handleQuestionReorder=function(i){var o=i.data("questionid"),s=i.index()+1;t.call([{methodname:"local_casospracticos_reorder_questions",args:{questionid:o,newposition:s}}])[0].done(function(t){t.success&&e(".question-item").each(function(t){e(this).find(".badge.bg-primary").text("#"+(t+1))})}).fail(n.exception)},a.prototype.enableInlineEdit=function(t){var n=this,i=t.html(),o=t.closest(".question-item").data("questionid"),s=e('<textarea class="form-control" rows="3"></textarea>').val(i.replace(/<br\s*\/?>/gi,"\n").replace(/<[^>]+>/g,""));t.html(s),s.focus().select(),s.on("blur",function(){n.saveInlineEdit(t,o,s.val(),i)}),s.on("keydown",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),s.blur()),"Escape"===e.key&&t.html(i)})},a.prototype.escapeHtml=function(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML},a.prototype.saveInlineEdit=function(e,i,o,s){if(o.trim()!==s.replace(/<br\s*\/?>/gi,"\n").replace(/<[^>]+>/g,"").trim()){var a=this.escapeHtml(o).replace(/\n/g,"<br>");t.call([{methodname:"local_casospracticos_update_question",args:{id:i,questiontext:a}}])[0].done(function(t){t.success?(e.html(a),n.addNotification({message:"Pregunta actualizada",type:"success"})):e.html(s)}).fail(function(){e.html(s),n.exception()})}else e.html(s)},a.prototype.confirmDeleteQuestion=function(e){var t=this,a=e.closest(".question-item"),c=a.data("questionid");i.get_strings([{key:"deletequestion",component:"local_casospracticos"},{key:"confirm"},{key:"yes"},{key:"no"}]).then(function(e){return o.create({type:o.types.SAVE_CANCEL,title:e[1],body:e[0]+"?"})}).then(function(e){e.setSaveButtonText(i.get_string("yes")),e.getRoot().on(s.save,function(){t.deleteQuestion(c,a)}),e.show()}).catch(n.exception)},a.prototype.deleteQuestion=function(i,o){t.call([{methodname:"local_casospracticos_delete_question",args:{id:i}}])[0].done(function(t){t.success&&o.fadeOut(300,function(){e(this).remove(),e(".question-item").each(function(t){e(this).find(".badge.bg-primary").text("#"+(t+1))});var t=e(".question-item").length;e(".case-questions h4 .badge").text(t)})}).fail(n.exception)},{init:function(e){return new a(e)}}});
//# sourceMappingURL=case_editor.min.js.map