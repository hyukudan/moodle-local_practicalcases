{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template local_casospracticos/case_view

    Template for displaying a single practical case with questions.

    Context variables required for this template:
    * case - Case object with name, statement, status, questions array
    * canedit - Boolean for edit capability
    * caninsert - Boolean for insert into quiz capability

    Example context (json):
    {
        "case": {
            "id": 1,
            "name": "Caso sobre silencio administrativo",
            "statement": "<p>Enunciado largo...</p>",
            "status": "published",
            "statusclass": "bg-success",
            "statuslabel": "Publicado",
            "questioncount": 3,
            "totalmarks": 3.0
        },
        "questions": [
            {
                "id": 1,
                "number": 1,
                "questiontext": "¿Cuál es el plazo?",
                "qtype": "multichoice",
                "qtypelabel": "Opción múltiple",
                "defaultmark": 1.0,
                "answers": [
                    {"id": 1, "answer": "3 meses", "iscorrect": true, "fraction": 100},
                    {"id": 2, "answer": "6 meses", "iscorrect": false, "fraction": 0}
                ]
            }
        ],
        "canedit": true,
        "caninsert": true
    }
}}
<div class="local-casospracticos-case-view" data-caseid="{{case.id}}">
    {{! Case Header }}
    <div class="case-header mb-4 pb-3 border-bottom">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h2 class="mb-2">{{case.name}}</h2>
                <span class="badge {{case.statusclass}}">{{case.statuslabel}}</span>
                {{#case.difficulty}}
                <span class="badge bg-info ms-2">
                    {{#str}}difficulty, local_casospracticos{{/str}}: {{case.difficulty}}/5
                </span>
                {{/case.difficulty}}
            </div>
            <div class="case-actions btn-group">
                {{#canedit}}
                <a href="{{editurl}}" class="btn btn-outline-primary">
                    {{#pix}}t/edit, core{{/pix}} {{#str}}editcase, local_casospracticos{{/str}}
                </a>
                <a href="{{newquestionurl}}" class="btn btn-outline-success">
                    {{#pix}}t/add, core{{/pix}} {{#str}}newquestion, local_casospracticos{{/str}}
                </a>
                {{/canedit}}
                {{#caninsert}}
                {{#case.hasquestions}}
                <a href="{{insertquizurl}}" class="btn btn-success">
                    {{#pix}}i/import, core{{/pix}} {{#str}}insertintoquiz, local_casospracticos{{/str}}
                </a>
                {{/case.hasquestions}}
                {{/caninsert}}
            </div>
        </div>
    </div>

    {{! Case Statement }}
    <div class="case-statement card mb-4">
        <div class="card-header">
            <h5 class="mb-0">{{#str}}casestatement, local_casospracticos{{/str}}</h5>
        </div>
        <div class="card-body">
            {{{case.statement}}}
        </div>
    </div>

    {{! Questions Section }}
    <div class="case-questions">
        <h4 class="mb-3">
            {{#str}}questions, local_casospracticos{{/str}}
            <span class="badge bg-secondary">{{case.questioncount}}</span>
        </h4>

        {{^questions}}
        <div class="alert alert-info">
            {{#str}}noquestions, local_casospracticos{{/str}}
            {{#canedit}}
            <a href="{{newquestionurl}}" class="alert-link">{{#str}}newquestion, local_casospracticos{{/str}}</a>
            {{/canedit}}
        </div>
        {{/questions}}

        {{#questions}}
        <div class="question-item card mb-3" data-questionid="{{id}}">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <span class="badge bg-primary me-2">#{{number}}</span>
                    <span class="badge bg-info">{{qtypelabel}}</span>
                    <span class="badge bg-secondary ms-2">{{defaultmark}} {{#str}}points, grades{{/str}}</span>
                </div>
                {{#canedit}}
                <div class="question-actions">
                    {{#canmoveup}}
                    <a href="{{moveupurl}}" class="btn btn-sm btn-link" title="{{#str}}moveup{{/str}}">
                        {{#pix}}t/up, core{{/pix}}
                    </a>
                    {{/canmoveup}}
                    {{#canmovedown}}
                    <a href="{{movedownurl}}" class="btn btn-sm btn-link" title="{{#str}}movedown{{/str}}">
                        {{#pix}}t/down, core{{/pix}}
                    </a>
                    {{/canmovedown}}
                    <a href="{{editurl}}" class="btn btn-sm btn-link" title="{{#str}}edit{{/str}}">
                        {{#pix}}t/edit, core{{/pix}}
                    </a>
                    <a href="{{deleteurl}}" class="btn btn-sm btn-link text-danger" title="{{#str}}delete{{/str}}">
                        {{#pix}}t/delete, core{{/pix}}
                    </a>
                </div>
                {{/canedit}}
            </div>
            <div class="card-body">
                <div class="question-text mb-3">
                    {{{questiontext}}}
                </div>

                {{#answers.length}}
                <ul class="list-group">
                    {{#answers}}
                    <li class="list-group-item {{#iscorrect}}list-group-item-success{{/iscorrect}}">
                        {{#iscorrect}}
                        {{#pix}}i/valid, core{{/pix}}
                        {{/iscorrect}}
                        {{{answer}}}
                        {{#showfraction}}
                        <span class="badge bg-info float-end">{{fraction}}%</span>
                        {{/showfraction}}
                    </li>
                    {{/answers}}
                </ul>
                {{/answers.length}}

                {{#generalfeedback}}
                <div class="alert alert-info mt-3 mb-0">
                    <strong>{{#str}}generalfeedback, local_casospracticos{{/str}}:</strong>
                    {{{generalfeedback}}}
                </div>
                {{/generalfeedback}}
            </div>
        </div>
        {{/questions}}
    </div>

    {{! Summary }}
    <div class="case-summary card mt-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <strong>{{#str}}numquestions, local_casospracticos, {{case.questioncount}}{{/str}}</strong>
                </div>
                <div class="col-md-4">
                    <strong>{{#str}}defaultmark, local_casospracticos{{/str}}:</strong> {{case.totalmarks}}
                </div>
                <div class="col-md-4 text-end">
                    <a href="{{backurl}}" class="btn btn-secondary">
                        {{#str}}backtocases, local_casospracticos{{/str}}
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

{{#js}}
require(['local_casospracticos/case_editor'], function(editor) {
    editor.init({{case.id}});
});
{{/js}}
